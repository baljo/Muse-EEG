# Introduction
<img align=right src="https://upload.wikimedia.org/wikipedia/commons/1/18/Human_Brain_-1.jpg?20160517061629" width="300" style="padding-left:10px">

In this tutorial you will learn how you can use a Muse EEG-device to control a simple Pong game by blinking your eyes. As a gentle introduction to the concept of humand and machine communication, the first part shows how to use Muse's *built-in* blink detection functionality and the second part shows how you can use Machine Learning (ML) using Edge Impulse (EI) to be able to expand the game. And while this is just playing a simple game by blinking, research in BCI-technology (Brain Computer Interface) has enabled earlier believed impossible tasks to become reality. One example of this is when patients suffering from ALS had a [brain implant inserted](https://www.bloomberg.com/news/articles/2022-07-18/brain-computer-interface-company-implants-new-type-of-device?leadSource=uverify%20wall) into a blood vessel in their brains, and after some training were able to communicate e.g. through WhatsApp messages. 


Once you understand the benefits and limitations of using EEG-data from a consumer-based device, you can yourself step up and try to control external devices like robots by using eye-blinks or perhaps even by thinking!



# What is EEG?
<img align=right src="https://live.staticflickr.com/5089/5335327140_028d4265c5_b.jpg" width="200" style="padding-left:10px">


Electroencephalography, or EEG, is a method to record the electrical activity generated by the brain via electrodes placed on the scalp surface. More information is found e.g. from [(Farnsworth, 2021)](https://imotions.com/blog/what-is-eeg/) or from [Wikipedia](https://en.wikipedia.org/wiki/Electroencephalography).

Professional or clinical EEG-devices are typically equipped with between 16 to 64 high-quality electrodes, and the cost is ~800 - 3000+ USD/EUR. They are mostly intended for research and clinical usage. Consumer-based devices on the other hand only have a few electrodes, but are much more affordable and are often also easier to use. Their main focus is on meditation and relaxation, but can with some limitations also be used for research (more about this in my [Master's thesis](https://urn.fi/URN:NBN:fi:amk-2022090219806)). 

<img align=left src="https://randomseed.io/rna/eeg-is-chasing-foamy-waves-meditation-experiment/i/muse2-brainwaves_hu292f7332cf5c66ba5894bf5e52638bcd_435046_1200x654_fill_q85_box_center.jpg" width="200" style="padding-right:10px">

Muse EEG-devices have four EEG-electrodes, two at the forehead, and two behind the ears. In addition they also have an accelerometer/gyroscope, and newer models include a PPG-sensor which  measures blood flow, breathing rhytm, and heart rate. In this tutorial however are  only signals from EEG-electrodes being used.  

  

# Prerequisites
To be able to reproduce examples found in this tutorial, you'll need:
 - A Muse EEG-device, any model should work, although Muse-01 (from 2014) streams with 220 Hz instead of 256 Hz and might require a few code changes if you are collecting raw data. They cost around 250 USD/EUR and are manufactured by the Canadian company [Interaxon Inc.](https://choosemuse.com/) 
 -  iPhone or Android phone
 - [Mind Monitor app](https://mind-monitor.com/) for iPhone or Android, one-time cost is ~15 USD/EUR
 - A computer able to run Python + WiFi
	 - only PC/Win10 tested although Mac and Linux computers are expected to work
 - Python 3.x

# Data flow

The data flow for both Part 1 and Part 2 is:
Your brain &rarr; Muse &rarr; Bluetooth &rarr; Phone/Mind Monitor &rarr; WiFi &rarr; Computer


# Preparations
**Python modules**

 - Install Python-OSC and Tkinter from a command prompt with 
```pip install python-osc``` and `pip install tk`

**Mind Monitor settings**

 - `OSC Stream Target IP`: here you should add your computer's local IP-address, on Win10 you can run `ipconfig` in a command prompt to find it, often starts with 192.168.x.x
 - `OSC Stream Port`: set to `5000`

**Computer**

 - You might need to allow the computer's firewall to allow traffic through port 5000.

# Part 1 - play Pong by blinking, no ML involved
<img align=right src="./Images/Blink_Pong.jpg" width="250" style="padding-left:10px">

In this first part you will learn how to control a Pong game just by blinking your eyes.
A short video of the Pong game is available [here](nnnnnnn). **<-- TBD**

## How does it work?

As mentioned earlier, this version is not using machine learning at all. Instead it is relying on built-in functionality in the Muse EEG-devices that can detect eye blinks and jaw clenches. These events produce distinct EEG-signals which can also be seen in the Mind Monitor graphs. The Pong game is then scanning for the events and reacting on them.

## Installation

 - Download the Python [code](https://github.com/baljo/Muse-EEG/blob/main/Blink%20Pong%20without%20ML.py)
 - Run the game from your favourite IDE or from the command prompt with `python "Blink Pong without ML.py"`

 ## Game play instructions
 - See [Game play instructions, common for both Part 1 and Part 2](https://github.com/baljo/Muse-EEG/blob/main/Project1.md#game-play-instructions-common-for-both-part-1-and-part-2)

# Part 2 - play Pong by blinking, using ML

## How does it work?

In short, you will here need to collect EEG-data from your Muse device and train a model in Edge Impulse. The trained model will then be used in the Pong game which otherwise functions as in Part 1.

## Process flow

While this is not as complex as brain surgery (:smirk:), it is still a bit more involving than Part 1. The main steps are listed here and will later on be explained in detail.
1. Collect EEG-data for the events you want to classify, e.g. eye blinks and background brain "noise"
2. Upload the EEG-data to Edge Impulse
3. Create, train, and test a ML-model in EI
4. Download the trained Tensorflow ML-model to your computer
5. Plug the model into your game and test it
6. Rinse and repeat from 1 as you'll probably need more data.

## Installation

 - Download the following Python programs
	- [Collect OSC-data.py](https://github.com/baljo/Muse-EEG/blob/main/Collect%20OSC-data.py) which you will use for collecting data
	- [Blink Pong with ML](https://github.com/baljo/Muse-EEG/blob/main/Blink%20Pong%20with%20ML.py) which is the game itself


## Detailed instructions

 <img align=right src="./Images/MindMonitor_stream_cropped.jpg" width="250" style="padding-left:10px">

**Connect Muse and start streaming**

 - Connect the Muse EEG-device to your phone
 - Start streaming from Mind Monitor by clicking on the button showed in the picture


# Game play instructions, common for both Part 1 and Part 2

 - Connect the Muse EEG-device to your phone
 - Start streaming from Mind Monitor by clicking on the button showed in the picture
 <img align=right src="./Images/MindMonitor_stream_cropped.jpg" width="250" style="padding-left:10px">

 - The objective of the game is to prevent the ball hitting the floor by moving the paddle.
 - You control the paddle by blinking
	 - Blink once to move the paddle in one direction
	 - Next blink will stop the paddle
	 - Next blink will move the paddle in the other direction
 - The score increases when you manage to hit the ball and decreases when you fail.
 - An intermittent message is shown whenever you blink or clench your jaw. Note that jaw clenches are  only available in Part 1, and they are not linked to any action in the game, that is left up to you to implement!


<div style="text-align: right"> **All images are either the author's or from Wikimedia Commons** </div>
